= PGroonga

: subtitle
   Make PostgreSQL\nfast full text search platform\nfor all languages!
: author
   Kouhei Sutou
: institution
   ClearCode Inc.
: content-source
   PGConf.ASIA 2016
: date
   2016-12-03
: allotted-time
   45m
: theme
   .

= PostgreSQL and me\n(('note:PostgreSQLã¨ç§'))

Some my patches are merged\n
(('note:ã„ãã¤ã‹ãƒ‘ãƒƒãƒãŒãƒãƒ¼ã‚¸ã•ã‚Œã¦ã„ã‚‹'))

= Patches\n(('note:ãƒ‘ãƒƒãƒ'))

  * (('wait'))BUG #13840: pg_dump generates unloadable SQL\n
    (('note:pg_dumpãŒãƒªã‚¹ãƒˆã‚¢ã§ããªã„SQLã‚’å‡ºåŠ›ã™ã‚‹'))
  * (('wait'))BUG #14160: DROP ACCESS METHOD IF EXISTS isn't impl.\n
    (('note:DROP ACCESS METHOD IF EXISTSãŒå®Ÿè£…ã•ã‚Œã¦ã„ãªã„'))

(('wait'))
(('tag:center'))
They are found while developing PGroonga\n
(('note:ã©ã¡ã‚‰ã‚‚PGroongaé–‹ç™ºä¸­ã«è¦‹ã¤ã‘ãŸå•é¡Œ'))

= PGroonga dev style\n(('note:PGroongaã®é–‹ç™ºã‚¹ã‚¿ã‚¤ãƒ«'))

  * When there are problems in related projects including PostgreSQL\n
    (('note:PostgreSQLã‚’å«ã‚€é–¢é€£ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å•é¡ŒãŒã‚ã£ãŸå ´åˆ'))
    * (('wait'))We fix these problems in these projects 
      instead of choosing workaround in PGroonga\n
      (('note:PGroongaå´ã§å›é¿ã™ã‚‹ã®ã§ã¯ãªã'))\n
      (('note:é–¢é€£ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ–¹ã§å•é¡Œã‚’ç›´ã™'))

= PostgreSQL and FTS\n(('note:PostgreSQLã¨å…¨æ–‡æ¤œç´¢'))

  * PostgreSQL has out-of-the-box full text search feature\n
    (('note:PostgreSQLã«ã¯çµ„è¾¼ã®å…¨æ–‡æ¤œç´¢æ©Ÿèƒ½ãŒã‚ã‚‹'))\n
    * (('wait'))It has some problems...\n
      (('note:ãŸã ã€ã„ãã¤ã‹å•é¡ŒãŒã‚ã‚‹'))
    * (('wait'))We fixed them by PGroonga\n
      (('note:PGroongaã‚’é–‹ç™ºã™ã‚‹ã“ã¨ã§ãã‚Œã‚‰ã®å•é¡Œã‚’ä¿®æ­£ã—ãŸ'))
    * (('wait'))instead of fixing PostgreSQL ğŸ˜“\n
      (('note:PostgreSQLã‚’ä¿®æ­£ã™ã‚‹ã®ã§ã¯ãªãã¦â€¦'))

= Because...\n(('note:ç†ç”±ã¯â€¦'))

  (1) (('wait'))Our approach is different from PostgreSQL's approach\n
      (('note:PGroongaã®ã‚„ã‚Šæ–¹ã¯PostgreSQLã®ã‚„ã‚Šæ–¹ã¨é•ã†'))
  (2) (('wait'))PG provides plugin system\n
      (('note:PostgreSQLã¯ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ä»•çµ„ã¿ã‚’æä¾›ã—ã¦ã„ã‚‹'))
      * Implementing as a plugin is PostgreSQL way!\n
        (('note:ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã®å®Ÿè£…ã¯PostgreSQLã‚‰ã—ã„ã‚„ã‚Šæ–¹ï¼'))

= PG FTS problem\n(('note:PostgreSQLã®å…¨æ–‡æ¤œç´¢ã®å•é¡Œ'))

(('tag:center'))
(('tag:margin-bottom * 4'))
Many langs aren't supported\n
(('note:ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„è¨€èªãŒãŸãã•ã‚“ã‚ã‚‹'))

  * (('wait'))e.g.: Asian languages\n
    (('note:ä¾‹ï¼šã‚¢ã‚¸ã‚¢ã®è¨€èª'))
    * Japanese, Chinese and more\n
      (('note:æ—¥æœ¬èªã‚„ä¸­å›½èªãªã©'))

= FTS for Japanese1\n(('note:æ—¥æœ¬èªã®å…¨æ–‡æ¤œç´¢1'))

  # coderay sql
  SELECT
    to_tsvector('japanese',
                'ã“ã‚“ã«ã¡ã¯');
  -- ERROR:  text search configuration
  --         "japanese" does not exist
  -- LINE 2:   to_tsvector('japanese',
  --                       ^

= FTS for Japanese2\n(('note:æ—¥æœ¬èªã®å…¨æ–‡æ¤œç´¢2'))

  # coderay sql
  CREATE EXTENSION pg_trgm;
  SELECT 'ã“ã‚“ã«ã¡ã¯' % 'ã«ã¡ã¯';
  --                    â†‘substring
  --  ?column? 
  -- ----------
  --  f â† Must be "t"!
  -- (1 row)

= Existing solution\n(('note:æ—¢å­˜ã®è§£æ±ºç­–'))

(('tag:center'))
pg_bigm

= pg_bigm

  * Similar to pg_trgm\n
    (('note:pg_trgmã¨ä¼¼ã¦ã„ã‚‹'))
    * Operator class for GIN\n
      (('note:GINç”¨ã®æ¼”ç®—å­ã‚¯ãƒ©ã‚¹'))

 # coderay sql
 CREATE INDEX index ON table
   USING gin (column gin_bigm_ops);

= pg_bigm: Demerit\n(('note:pg_bigmï¼šãƒ‡ãƒ¡ãƒªãƒƒãƒˆ'))

  * Slow for large document\n
    (('note:æ–‡æ›¸ãŒé•·ã„ã¨é…ã„'))\n
    (('note:(Normally, we want to use FTS for large document)'))\n
    (('note:ï¼ˆæ™®é€šã¯é•·ã„æ–‡æ›¸ã«å¯¾ã—ã¦å…¨æ–‡æ¤œç´¢ã—ãŸã„ï¼‰'))
    * Because it needs "recheck"\n
      (('note:ã€Œrecheckã€ãŒå¿…è¦ã ã‹ã‚‰'))

= "recheck"

  * "Exact" seq. search after\n
    "loose" index search\n
    (('note:ã€Œã‚†ã‚‹ã„ã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ¤œç´¢ã®å¾Œã«å®Ÿè¡Œã™ã‚‹'))\n
    (('note:ã€Œæ­£ç¢ºãªã€ã‚·ãƒ¼ã‚±ãƒ³ã‚·ãƒ£ãƒ«ã‚µãƒ¼ãƒ'))
    * (('wait'))The larger text, the slower\n
      (('note:å¯¾è±¡ãƒ†ã‚­ã‚¹ãƒˆãŒå¤§ãã‘ã‚Œã°å¤§ãã„ã»ã©é…ããªã‚‹'))\n
    * (('wait'))text = doc size * N docs\n
      (('note:å¯¾è±¡ãƒ†ã‚­ã‚¹ãƒˆ = æ–‡æ›¸ã‚µã‚¤ã‚º * æ–‡æ›¸æ•°'))

= Benchmark\n(('note:ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯'))

  # image
  # src = images/search-pg-bigm.pdf
  # relative_height = 100

= New solution\n(('note:æ–°ã—ã„è§£æ±ºç­–'))

  # image
  # src = images/pgroonga-logo.svg
  # relative_width = 100

= PGroonga

  * Pronunciation: pÃ­ËzÃ­:lÃºnÉ¡á½±\n
    (('note:èª­ã¿æ–¹ï¼šã´ãƒ¼ã˜ãƒ¼ã‚‹ã‚“ãŒ'))

  * (('wait'))Index and operator classes\n
    (('note:ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¨æ¼”ç®—å­ã‚¯ãƒ©ã‚¹'))
    * Not operator classes for GIN\n
      (('note:GINã®æ¼”ç®—å­ã‚¯ãƒ©ã‚¹ã§ã¯ãªã„'))

= PGroonga layer

  # image
  # src = images/pgroonga-layer.svg
  # relative_width = 100

= Benchmark\n(('note:ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯'))

  # image
  # src = images/search-pgroonga-pg-bigm.pdf
  # relative_height = 100

= Wrap up1\n(('note:ã¾ã¨ã‚1'))

  * PostgreSQL doesn't support Asian languages\n
    (('note:PostgreSQLã¯ã‚¢ã‚¸ã‚¢ã®è¨€èªã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„'))

  * pg_bigm and PGroonga support all languages\n
    (('note:pg_bigmã¨PGroongaã¯ã™ã¹ã¦ã®è¨€èªã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹'))

= Wrap up2\n(('note:ã¾ã¨ã‚2'))

  * Many hits case:\n
    (('note:ãƒ’ãƒƒãƒˆæ•°ãŒå¤šã„å ´åˆ'))
    * pg_bigm is slow\n
      (('note:pg_bigmã¯é…ã„'))
    * PGroonga is fast\n
      (('note:PGroongaã¯é€Ÿã„'))

= Why is PGroonga fast?\n(('note:PGroongaã¯ã©ã†ã—ã¦é€Ÿã„ã®ã‹'))

  * Doesn't need "recheck"\n
    (('note:ã€Œrecheckã€ãŒå¿…è¦ãªã„ã‹ã‚‰'))

  * (('wait'))Why not needed?\n
    (('note:ã©ã†ã—ã¦PGroongaã¯ã€Œrecheckã€ãŒå¿…è¦ãªã„ã®ã‹ï¼Ÿ'))
    * Because PGroonga is\n
      ((*full*)) inverted index\n
      (('note:PGroongaã¯((*å®Œå…¨*))è»¢ç½®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã ã‹ã‚‰'))\n
      (('note:(GIN is inverted index)'))\n
      (('note:ï¼ˆGINã¯ãŸã ã®è»¢ç½®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼‰'))

= Full inverted index\n(('note:å®Œå…¨è»¢ç½®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹'))

Including position\n
(('note:ä½ç½®æƒ…å ±ã‚’å«ã‚€'))

= Inverted index diff\n(('note:è»¢ç½®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®é•ã„'))

  # image
  # src = images/inverted-index.svg
  # relative_height = 100
