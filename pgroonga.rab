= PGroonga

: subtitle
   Make PostgreSQL\nfast full text search platform\nfor all languages!
: author
   Kouhei Sutou
: institution
   ClearCode Inc.
: content-source
   PGConf.ASIA 2016
: date
   2016-12-03
: allotted-time
   45m
: theme
   .

= PostgreSQL and me\n(('note:PostgreSQLã¨ç§'))

Some my patches are merged\n
(('note:ã„ãã¤ã‹ãƒ‘ãƒƒãƒãŒãƒãƒ¼ã‚¸ã•ã‚Œã¦ã„ã‚‹'))

= Patches\n(('note:ãƒ‘ãƒƒãƒ'))

  * (('wait'))BUG #13840: pg_dump generates unloadable SQL\n
    (('note:pg_dumpãŒãƒªã‚¹ãƒˆã‚¢ã§ããªã„SQLã‚’å‡ºåŠ›ã™ã‚‹'))
  * (('wait'))BUG #14160: DROP ACCESS METHOD IF EXISTS isn't impl.\n
    (('note:DROP ACCESS METHOD IF EXISTSãŒå®Ÿè£…ã•ã‚Œã¦ã„ãªã„'))

(('wait'))
(('tag:center'))
They are found while developing PGroonga\n
(('note:ã©ã¡ã‚‰ã‚‚PGroongaé–‹ç™ºä¸­ã«è¦‹ã¤ã‘ãŸå•é¡Œ'))

= PGroonga dev style\n(('note:PGroongaã®é–‹ç™ºã‚¹ã‚¿ã‚¤ãƒ«'))

  * When there are problems in related projects including PostgreSQL\n
    (('note:PostgreSQLã‚’å«ã‚€é–¢é€£ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å•é¡ŒãŒã‚ã£ãŸå ´åˆ'))
    * (('wait'))We fix these problems in these projects 
      instead of choosing workaround in PGroonga\n
      (('note:PGroongaå´ã§å›é¿ã™ã‚‹ã®ã§ã¯ãªã'))\n
      (('note:é–¢é€£ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ–¹ã§å•é¡Œã‚’ç›´ã™'))

= PostgreSQL and FTS\n(('note:PostgreSQLã¨å…¨æ–‡æ¤œç´¢'))

  * PostgreSQL has out-of-the-box full text search feature\n
    (('note:PostgreSQLã«ã¯çµ„è¾¼ã®å…¨æ–‡æ¤œç´¢æ©Ÿèƒ½ãŒã‚ã‚‹'))\n
    * (('wait'))It has some problems...\n
      (('note:ãŸã ã€ã„ãã¤ã‹å•é¡ŒãŒã‚ã‚‹'))
    * (('wait'))We fixed them by PGroonga\n
      (('note:PGroongaã‚’é–‹ç™ºã™ã‚‹ã“ã¨ã§ãã‚Œã‚‰ã®å•é¡Œã‚’ä¿®æ­£ã—ãŸ'))
    * (('wait'))instead of fixing PostgreSQL ğŸ˜“\n
      (('note:PostgreSQLã‚’ä¿®æ­£ã™ã‚‹ã®ã§ã¯ãªãã¦â€¦'))

= Because...\n(('note:ç†ç”±ã¯â€¦'))

  (1) (('wait'))Our approach is different from PostgreSQL's approach\n
      (('note:PGroongaã®ã‚„ã‚Šæ–¹ã¯PostgreSQLã®ã‚„ã‚Šæ–¹ã¨é•ã†'))
  (2) (('wait'))PG provides plugin system\n
      (('note:PostgreSQLã¯ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ä»•çµ„ã¿ã‚’æä¾›ã—ã¦ã„ã‚‹'))
      * Implementing as a plugin is PostgreSQL way!\n
        (('note:ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã®å®Ÿè£…ã¯PostgreSQLã‚‰ã—ã„ã‚„ã‚Šæ–¹ï¼'))

= PG FTS problem\n(('note:PostgreSQLã®å…¨æ–‡æ¤œç´¢ã®å•é¡Œ'))

(('tag:center'))
(('tag:margin-bottom * 4'))
Many langs aren't supported\n
(('note:ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„è¨€èªãŒãŸãã•ã‚“ã‚ã‚‹'))

  * (('wait'))e.g.: Asian languages\n
    (('note:ä¾‹ï¼šã‚¢ã‚¸ã‚¢ã®è¨€èª'))
    * Japanese, Chinese and more\n
      (('note:æ—¥æœ¬èªã‚„ä¸­å›½èªãªã©'))

= FTS for Japanese1\n(('note:æ—¥æœ¬èªã®å…¨æ–‡æ¤œç´¢1'))

  # coderay sql
  SELECT
    to_tsvector('japanese',
                'ã“ã‚“ã«ã¡ã¯');
  -- ERROR:  text search configuration
  --         "japanese" does not exist
  -- LINE 2:   to_tsvector('japanese',
  --                       ^

= FTS for Japanese2\n(('note:æ—¥æœ¬èªã®å…¨æ–‡æ¤œç´¢2'))

  # coderay sql
  CREATE EXTENSION pg_trgm;
  SELECT show_trgm('ã“ã‚“ã«ã¡ã¯');
  --  show_trgm 
  -- -----------
  --  {} â† Must not empty!
  -- (1 row)

= Existing solution\n(('note:æ—¢å­˜ã®è§£æ±ºç­–'))

(('tag:center'))
pg_bigm

= pg_bigm

  * An extension\n
    (('note:æ‹¡å¼µæ©Ÿèƒ½'))
  * (('wait'))Similar to pg_trgm\n
    (('note:pg_trgmã¨ä¼¼ã¦ã„ã‚‹'))
    * Operator class for GIN\n
      (('note:GINç”¨ã®æ¼”ç®—å­ã‚¯ãƒ©ã‚¹'))

= pg_bigm: Usage\n(('note:pg_bigmï¼šä½¿ã„æ–¹'))

  # coderay sql
  CREATE INDEX index ON table
    USING GIN (column gin_bigm_ops);
  --     â†‘Use GIN   â†‘Specify op class

= pg_bigm: Demerit\n(('note:pg_bigmï¼šãƒ‡ãƒ¡ãƒªãƒƒãƒˆ'))

  * Slow for large document\n
    (('note:æ–‡æ›¸ãŒé•·ã„ã¨é…ã„'))\n
    (('note:(Normally, we want to use FTS for large document)'))\n
    (('note:ï¼ˆæ™®é€šã¯é•·ã„æ–‡æ›¸ã«å¯¾ã—ã¦å…¨æ–‡æ¤œç´¢ã—ãŸã„ï¼‰'))
    * (('wait'))Because it needs "recheck"\n
      (('note:ã€Œrecheckã€ãŒå¿…è¦ã ã‹ã‚‰'))

= "recheck"

  * "Exact" seq. search after\n
    "loose" index search\n
    (('note:ã€Œã‚†ã‚‹ã„ã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ¤œç´¢ã®å¾Œã«å®Ÿè¡Œã™ã‚‹'))\n
    (('note:ã€Œæ­£ç¢ºãªã€ã‚·ãƒ¼ã‚±ãƒ³ã‚·ãƒ£ãƒ«ã‚µãƒ¼ãƒ'))
    * (('wait'))The larger text, the slower\n
      (('note:å¯¾è±¡ãƒ†ã‚­ã‚¹ãƒˆãŒå¤§ãã‘ã‚Œã°å¤§ãã„ã»ã©é…ããªã‚‹'))\n
    * (('wait'))text = doc size * N docs\n
      (('note:å¯¾è±¡ãƒ†ã‚­ã‚¹ãƒˆ = æ–‡æ›¸ã‚µã‚¤ã‚º * æ–‡æ›¸æ•°'))

= Benchmark\n(('note:ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯'))

  # image
  # src = images/search-pg-bigm.pdf
  # relative_height = 100

= New solution\n(('note:æ–°ã—ã„è§£æ±ºç­–'))

  # image
  # src = images/pgroonga-logo.svg
  # relative_width = 100

= PGroonga

  * Pronunciation: pÃ­ËzÃ­:lÃºnÉ¡á½±\n
    (('note:èª­ã¿æ–¹ï¼šã´ãƒ¼ã˜ãƒ¼ã‚‹ã‚“ãŒ'))

  * (('wait'))An extension\n
    (('note:æ‹¡å¼µæ©Ÿèƒ½'))

  * (('wait'))Index and operator classes\n
    (('note:ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¨æ¼”ç®—å­ã‚¯ãƒ©ã‚¹'))
    * Not operator classes for GIN\n
      (('note:GINã®æ¼”ç®—å­ã‚¯ãƒ©ã‚¹ã§ã¯ãªã„'))

= PGroonga layer

  # image
  # src = images/pgroonga-layer.svg
  # relative_width = 100

= Benchmark\n(('note:ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯'))

  # image
  # src = images/search-pgroonga-pg-bigm.pdf
  # relative_height = 100

= Wrap up1\n(('note:ã¾ã¨ã‚1'))

  * PostgreSQL doesn't support Asian languages\n
    (('note:PostgreSQLã¯ã‚¢ã‚¸ã‚¢ã®è¨€èªã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„'))

  * pg_bigm and PGroonga support all languages\n
    (('note:pg_bigmã¨PGroongaã¯ã™ã¹ã¦ã®è¨€èªã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹'))

= Wrap up2\n(('note:ã¾ã¨ã‚2'))

  * Many hits case:\n
    (('note:ãƒ’ãƒƒãƒˆæ•°ãŒå¤šã„å ´åˆ'))
    * pg_bigm is slow\n
      (('note:pg_bigmã¯é…ã„'))
    * PGroonga is fast\n
      (('note:PGroongaã¯é€Ÿã„'))

= Why is PGroonga fast?\n(('note:PGroongaã¯ã©ã†ã—ã¦é€Ÿã„ã®ã‹'))

  * Doesn't need "recheck"\n
    (('note:ã€Œrecheckã€ãŒå¿…è¦ãªã„ã‹ã‚‰'))

  * (('wait'))Is "recheck" really slow?\n
    (('note:æœ¬å½“ã«ã€Œrecheckã€ãŒé…ã„ã®ï¼Ÿ'))
    * See one more benchmark result\n
      (('note:ã‚‚ã†ä¸€ã¤ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯çµæœã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†'))

= Benchmark\n(('note:ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯'))

  # image
  # src = images/search-pgroonga-pg-bigm-all.pdf
  # relative_height = 100

= Why is pg_bigm fast?\n(('note:pg_bigmã¯ã©ã†ã—ã¦é€Ÿã„ã®ã‹'))

  * Query is "æ—¥æœ¬"\n
    (('note:ã‚¯ã‚¨ãƒªãƒ¼ã¯ã€Œæ—¥æœ¬ã€'))
    * Point: 2 characters\n
      (('note:ãƒã‚¤ãƒ³ãƒˆï¼š2æ–‡å­—'))
  * (('wait'))pg_bigm doesn't need "recheck" for 2 chars query\n
    (('note:pg_bigmã¯2æ–‡å­—ã®ã‚¯ã‚¨ãƒªãƒ¼ã«ã€Œrecheckã€ã®å¿…è¦ãŒãªã„'))
    * It means that "recheck" is slow\n
      (('note:ã¤ã¾ã‚Šã€Œrecheckã€ãŒé…ã„ã¨ã„ã†ã“ã¨'))

= N-gram and "recheck"\n(('note:N-gramã¨ã€Œrecheckã€'))

  * N-gram approach needs "phrase search" when query has N+1 or more characters\n
    (('note:N+1æ–‡å­—ä»¥ä¸Šã®ã‚¯ã‚¨ãƒªãƒ¼ã«ã¯ã€Œãƒ•ãƒ¬ãƒ¼ã‚ºæ¤œç´¢ã€ãŒå¿…è¦'))
    * N=2 for pg_bigm, N=3 for pg_trgm\n
      (('note:pg_bigmã¯N=2ã§pg_trgmã¯N=3'))

  * (('wait'))GIN needs "recheck" for "phrase search"\n
    (('note:GINã¯ã€Œãƒ•ãƒ¬ãƒ¼ã‚ºæ¤œç´¢ã€ã«ã¯ã€Œrecheckã€ãŒå¿…è¦'))

= Phrase search\n(('note:ãƒ•ãƒ¬ãƒ¼ã‚ºæ¤œç´¢'))

  * Phrase search is "token search" and "position check"\n
    (('note:ãƒ•ãƒ¬ãƒ¼ã‚ºæ¤œç´¢ã¯ã€Œãƒˆãƒ¼ã‚¯ãƒ³æ¤œç´¢ã€ã¨ã€Œä½ç½®ãƒã‚§ãƒƒã‚¯ã€'))
    * Tokens must exist and be ordered\n
      (('note:ãƒˆãƒ¼ã‚¯ãƒ³ã¯åŒã˜é †åºã§å‡ºç¾ã—ã¦ã„ãªã„ã¨ã„ã‘ãªã„'))
    * OK: "car at" for "car at" query
    * NG: "at car" for "car at" query

= N-gram and phrase search

  (1) Split text to tokens\n
      (('note:ãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒˆãƒ¼ã‚¯ãƒ³ã«åˆ†å‰²'))
      * "cat"â†’"ca","at"
  (2) ((*Search all tokens*))\n
      (('note:ã™ã¹ã¦ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¤œç´¢'))
      * "ca" and "at" exist: Candidate!
  (3) ((*Check appearance pos.*))\n
      (('note:å‡ºç¾ä½ç½®ã‚’ãƒã‚§ãƒƒã‚¯'))
      * "ca" then "at": Found!

= N-gram and GIN: Create\n(('note:N-gramã¨GINï¼šä½œæˆ'))

  # image
  # src = images/gin-n-gram-index.svg
  # relative_height = 100

= N-gram and GIN: Search\n(('note:N-gramã¨GINï¼šæ¤œç´¢'))

  # image
  # src = images/gin-n-gram-search.svg
  # relative_height = 100

= GIN and phrase search\n(('note:GINã¨ãƒ•ãƒ¬ãƒ¼ã‚ºæ¤œç´¢'))

  * Phrase search needs position check\n
    (('note:ãƒ•ãƒ¬ãƒ¼ã‚ºæ¤œç´¢ã§ã¯å‡ºç¾ä½ç½®ãƒã‚§ãƒƒã‚¯ãŒå¿…è¦'))
  * GIN doesn't support position check\n
    (('note:GINã¯å‡ºç¾ä½ç½®ãƒã‚§ãƒƒã‚¯ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„'))
    * â†’GIN needs "recheck"â†’Slow!\n
      (('note:GINã§ã¯ã€Œrecheckã€ãŒå¿…è¦ã ã‹ã‚‰é…ã„'))

= Why is PGroonga fast?\n(('note:PGroongaã¯ã©ã†ã—ã¦é€Ÿã„ã®ã‹'))

  * PGroonga uses N-gram (('note:by default'))\n
    (('note:PGroongaã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§N-gramã‚’ä½¿ã£ã¦ã„ã‚‹'))
  * But doesn't need "recheck"\n
    (('note:PGroongaã¯ã€Œrecheckã€ã®å¿…è¦ãŒãªã„'))

= Why no "recheck"?\n(('note:ã©ã†ã—ã¦ã€Œrecheckã€ãŒå¿…è¦ãªã„ã®ã‹'))

PGroonga uses\n
((*full*))\n
inverted index\n
(('note:PGroongaã¯((*å®Œå…¨*))è»¢ç½®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½¿ã£ã¦ã„ã‚‹ã‹ã‚‰'))

= Full inverted index\n(('note:å®Œå…¨è»¢ç½®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹'))

Including position\n
(('note:ä½ç½®æƒ…å ±ã‚’å«ã‚€'))

= Inverted index diff\n(('note:è»¢ç½®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®é•ã„'))

  # image
  # src = images/inverted-index.svg
  # relative_height = 100

= N-gram/PGroonga: Search\n(('note:N-gramã¨PGroongaï¼šæ¤œç´¢'))

  # image
  # src = images/pgroonga-n-gram-search.svg
  # relative_height = 100

= Wrap up\n(('note:ã¾ã¨ã‚'))

  * N-gram needs phrase search\n
    (('note:N-gramã®å ´åˆã¯ãƒ•ãƒ¬ãƒ¼ã‚ºæ¤œç´¢ãŒå¿…è¦'))
  * Full inverted index provides fast phrase search\n
    (('note:å®Œå…¨è»¢ç½®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½¿ã†ã¨é«˜é€Ÿã«ãƒ•ãƒ¬ãƒ¼ã‚ºæ¤œç´¢ã§ãã‚‹'))
    * GIN isn't full inverted index\n
      (('note:GINã¯å®Œå…¨è»¢ç½®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã§ã¯ãªã„'))
    * PGroonga uses full inverted index\n
      (('note:PGroongaã¯å®Œå…¨è»¢ç½®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½¿ã£ã¦ã„ã‚‹'))

= FTS and English(*)\n(('note:å…¨æ–‡æ¤œç´¢ã¨è‹±èª'))

  * Normally, N-gram isn't used for English FTS\n
    (('note:æ™®é€šã¯è‹±èªã®å…¨æ–‡æ¤œç´¢ã«N-gramã‚’ä½¿ã‚ãªã„'))
    * (('wait'))N-gram is slower than word based approach (textsearch approach)\n
      (('note:N-gramã¯å˜èªãƒ™ãƒ¼ã‚¹ã®ã‚„ã‚Šæ–¹ï¼ˆtextsearchã®ã‚„ã‚Šæ–¹ï¼‰ã‚ˆã‚Šé…ã‚'))
    * (('wait'))Stemming/stop word can't be used\n
      (('note:N-gramã§ã¯ã‚¹ãƒ†ãƒŸãƒ³ã‚°ã¨ã‚¹ãƒˆãƒƒãƒ—ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ãˆãªã„'))

(('note:(*) Englishâ‰’Alphabet based languages'))

= PGroonga and English\n(('note:PGroongaã¨è‹±èª'))

  * PGroonga uses N-gram (('note:by default'))\n
    (('note:PGroongaã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯N-gramã‚’ä½¿ã†'))
    * Is PGroonga slow for English?\n
      (('note:ã§ã¯PGroongaã¯è‹±èªã§ã¯é…ã„ã®ã‹ï¼Ÿ'))
    * (('wait'))No. Similar to textsearch\n
      (('note:é…ããªã„ã€‚textsearchã¨åŒã˜ãã‚‰ã„'))

= PGroonga: Search\n(('note:PGroongaï¼šæ¤œç´¢'))

  # image
  # src = images/search-pgroonga-textsearch.pdf
  # relative_height = 100

= PGroonga's N-gram

  * Variable size N-gram\n
    (('note:å¯å¤‰é•·ã‚µã‚¤ã‚ºã®N-gram'))
    * Continuous alphabets are 1 token\n
      (= word based approach)\n
      (('note:é€£ç¶šã—ãŸã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã¯1ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆ=å˜èªãƒ™ãƒ¼ã‚¹ï¼‰'))\n
      Helloâ†’"Hello" not "He","el",â€¦
    * No alphabet is 2-gram\n
      (('note:éã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã¯2-gram'))\n
      ã“ã‚“ã«ã¡ã¯â†’"ã“ã‚“","ã‚“ã«",â€¦

= Wrap up1\n(('note:ã¾ã¨ã‚1'))

  * PGroonga's search is fast for all languages\n
    (('note:PGroongaã®æ¤œç´¢ã¯ã™ã¹ã¦ã®è¨€èªã§é€Ÿã„'))
    * Including alphabet based languages and Asian languages mixed case\n
      (('note:ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆãƒ™ãƒ¼ã‚¹ã®è¨€èªã¨ã‚¢ã‚¸ã‚¢ã®è¨€èªãŒæ··ã–ã£ãŸå ´åˆã§ã‚‚é€Ÿã„'))\n
      (('note:(textsearch doesn't support mixed case)'))\n
      (('note:ï¼ˆtextsearchã¯è¨€èªã‚’æ··ãœã‚‹ã“ã¨ã¯ã§ããªã„ï¼‰'))

= Wrap up2\n(('note:ã¾ã¨ã‚2'))

(('tag:center'))
PGroonga makes PostgreSQL\n
fast full text search platform\n
for all languages!

(('tag:center'))
(('note:PGroongaã§PostgreSQLãŒ'))\n
(('note:å…¨è¨€èªå¯¾å¿œé«˜é€Ÿå…¨æ–‡æ¤œç´¢ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã«ãªã‚‹ï¼'))

= More about PGroonga\n(('note:PGroongaã«ã¤ã„ã¦ã‚‚ã£ã¨'))

  * Performance\n
    (('note:æ€§èƒ½'))
  * Japanese specific feature\n
    (('note:æ—¥æœ¬èªå‘ã‘ã®æ©Ÿèƒ½'))
  * JSON support\n
    (('note:JSONã‚µãƒãƒ¼ãƒˆ'))
  * Replication\n
    (('note:ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³'))

= Performance\n(('note:æ€§èƒ½'))

  * Search and update\n(('note:æ¤œç´¢ã¨æ›´æ–°'))
  * Index only scan\n(('note:ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚ªãƒ³ãƒªãƒ¼ã‚¹ã‚­ãƒ£ãƒ³'))
  * Direct Groonga search\n(('note:ç›´æ¥Groongaã§æ¤œç´¢'))
  * Index creation\n(('note:ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆ'))

= Search and update\n(('note:æ¤œç´¢ã¨æ›´æ–°'))

  * Doesn't decrease search performance while updating\n
    (('note:æ›´æ–°ä¸­ã‚‚æ¤œç´¢æ€§èƒ½ãŒè½ã¡ãªã„'))

= Characteristics\n(('note:å‚¾å‘'))

  # image
  # src = images/performance-charcteristic-for-constant-read-and-write.svg
  # relative_height = 100

= Update and lock\n(('note:æ›´æ–°ã¨ãƒ­ãƒƒã‚¯'))

  * Update without ((*read*)) locks\n
    (('note:((*å‚ç…§*))ãƒ­ãƒƒã‚¯ãªã—ã§æ›´æ–°'))
    * ((*Write*)) locks are required\n
      (('note:((*æ›¸ãè¾¼ã¿*))ãƒ­ãƒƒã‚¯ã¯å¿…è¦'))

= GIN: Read/Write\n(('note:GINï¼šèª­ã¿æ›¸ã'))

  # image
  # src = images/read-while-write-gin.svg
  # relative_height = 100

= PGroonga: Read/Write\n(('note:PGroongaï¼šèª­ã¿æ›¸ã'))

  # image
  # src = images/read-while-write-pgroonga.svg
  # relative_height = 100

= Fast stably\n(('note:å®‰å®šã—ã¦é€Ÿã„'))

  * GIN has intermittent performance decrements\n
    (('note:GINã¯é–“æ¬ çš„ãªæ€§èƒ½åŠ£åŒ–ãŒã‚ã‚‹'))
    * For details:ğŸ”"GIN pending list"\n
      (('note:è©³ç´°ã¯ã€ŒGIN pending listã€ã§æ¤œç´¢'))
  * PGroonga keeps fast search\n
    (('note:PGroongaã¯é«˜é€Ÿãªæ¤œç´¢ã‚’ç¶­æŒ'))
    * PGroonga keeps index updated\n
      (('note:PGroongaã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¯å¸¸ã«æœ€æ–°çŠ¶æ…‹'))

= Index only scan\n(('note:ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚ªãƒ³ãƒªãƒ¼ã‚¹ã‚­ãƒ£ãƒ³'))

  * GIN: Not supported\n
    (('note:GINï¼šæœªã‚µãƒãƒ¼ãƒˆ'))
  * PGroonga: Supported\n
    (('note:PGroongaï¼šã‚µãƒãƒ¼ãƒˆ'))

= More faster search\n(('note:ã‚ˆã‚Šé«˜é€Ÿãªæ¤œç´¢'))

  * Direct Groonga search is more faster\n
    (('note:ç›´æ¥Groongaã§æ¤œç´¢ã™ã‚‹ã¨ã•ã‚‰ã«é«˜é€Ÿ'))
    * Groonga: Full text search engine PGroonga uses\n
      (('note:Groongaï¼šPGroongaãŒä½¿ã£ã¦ã„ã‚‹å…¨æ–‡æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³'))

= Direct Groonga search\n(('note:ç›´æ¥Groongaã§æ¤œç´¢'))

  # image
  # src = images/search-pgroonga-groonga-textsearch.pdf
  # relative_height = 100

= Index creation time\n(('note:ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆæ™‚é–“'))

  # image
  # src = images/index-creation-en.pdf
  # relative_height = 100

= Performance: Wrap up\n(('note:æ€§èƒ½ï¼šã¾ã¨ã‚'))

  * Keep fast search with update\n
    (('note:æ›´æ–°ã—ãªãŒã‚‰ã§ã‚‚é«˜é€Ÿæ¤œç´¢ã‚’ç¶­æŒ'))
  * Support index only scan\n
    (('note:ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚ªãƒ³ãƒªãƒ¼ã‚¹ã‚­ãƒ£ãƒ³ã‚’ã‚µãƒãƒ¼ãƒˆ'))
  * Direct Groonga search is more faster\n
    (('note:Groongaç›´æ¥æ¤œç´¢ã¯ã‚‚ã£ã¨é€Ÿã„'))
  * Fast index creation\n
    (('note:ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆã‚‚é€Ÿã„'))

= Japanese specific feature\n(('note:æ—¥æœ¬èªå‘ã‘ã®æ©Ÿèƒ½'))

  * Completion by Romaji\n
    (('note:ãƒ­ãƒ¼ãƒå­—ã«ã‚ˆã‚‹å…¥åŠ›è£œå®Œ'))

= Completion: Table\n(('note:å…¥åŠ›è£œå®Œï¼šãƒ†ãƒ¼ãƒ–ãƒ«'))

  # coderay sql

  CREATE TABLE stations (
    name text,
    readings text[]
    -- â†‘Support N readings
  );

= Completion: Data\n(('note:å…¥åŠ›è£œå®Œï¼šãƒ‡ãƒ¼ã‚¿'))

  # coderay sql

  INSERT INTO stations VALUES
  ('Tokyo',
   ARRAY['ãƒˆã‚¦ã‚­ãƒ§ã‚¦']),
  -- â†‘In Katakana
  -- (...),
  ('Akihabara',
   ARRAY['ã‚¢ã‚­ãƒãƒãƒ©', 'ã‚¢ã‚­ãƒ']);

= Completion: Index\n(('note:å…¥åŠ›è£œå®Œï¼šã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹'))

  # coderay sql

  CREATE INDEX pgroonga_index
    ON stations
    USING pgroonga (
      -- â†“For prefix and prefix Romaji/Katakana search
      name     pgroonga.text_term_search_ops_v2,
      -- â†“For prefix and prefix Romaji/Katakana search
      --   against array
      readings pgroonga.text_array_term_search_ops_v2);

= Completion: Search\n(('note:å…¥åŠ›è£œå®Œï¼šæ¤œç´¢'))

  # coderay sql

  SELECT name, readings
    FROM stations
   WHERE name &^ 'tou' OR
      -- â†‘Prefix search
         readings &^~> 'tou'
      -- â†‘Prefix Romaji/Katakana search
   ORDER BY name LIMIT 10;

= Completion: Result\n(('note:å…¥åŠ›è£œå®Œï¼šçµæœ'))

(('tag:center'))
Hit by\n
prefix Romaji/Katakana search\n
"tou"(Romaji)â†’"ãƒˆã‚¦"(Katakana)\n
(('note:å‰æ–¹ä¸€è‡´RKæ¤œç´¢ã§ãƒ’ãƒƒãƒˆ'))

  # _
   name  |   readings   
  -------+--------------
   Tokyo | {ãƒˆã‚¦ã‚­ãƒ§ã‚¦}
  (1 row)

= For Japanese: Wrap up\n(('note:æ—¥æœ¬èªå‘ã‘æ©Ÿèƒ½ï¼šã¾ã¨ã‚'))

  * Support prefix Romaji/Kana search\n
    (('note:å‰æ–¹ä¸€è‡´RKæ¤œç´¢ã‚’ã‚µãƒãƒ¼ãƒˆ'))
    * Useful for implementing auto complete feature in search box\n
      (('note:æ¤œç´¢æ¬„ã«ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆæ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹æ™‚ã«ä¾¿åˆ©'))
    * Users don't need to convert Romaji to Kanji\n
      (('note:ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ­ãƒ¼ãƒå­—ã‚’æ¼¢å­—ã«å¤‰æ›ã™ã‚‹å¿…è¦ãŒãªã„'))

= JSON support\n(('note:JSONã‚µãƒãƒ¼ãƒˆ'))

  * Support full text search\n
    (('note:å…¨æ–‡æ¤œç´¢å¯¾å¿œ'))
    * Target: All texts in JSON\n
      (('note:JSONå†…ã®ã™ã¹ã¦ã®ãƒ†ã‚­ã‚¹ãƒˆ'))
    * Not only a text in a path\n
      (('note:ç‰¹å®šã®ãƒ‘ã‚¹ã®ãƒ†ã‚­ã‚¹ãƒˆã ã‘ã§ã¯ãªã„'))\n
      (('note:(GIN supports only this style)'))\n
      (('note:ï¼ˆGINã¯ã“ã®ã‚„ã‚Šæ–¹ã ã‘ã‚µãƒãƒ¼ãƒˆï¼‰'))

= JSON: FTS\n(('note:JSONï¼šå…¨æ–‡æ¤œç´¢'))

  # coderay sql
  INSERT INTO logs (record)
    VALUES ('{"host": "app1"}'),
           ('{"message": "app is down"}');
  SELECT * FROM logs
    WHERE record @@ 'string @@ "app"'
  --          record
  -- --------------------------
  -- {"host":    "app1"}
  -- {"message": "app is down"}

= JSON: Wrap up\n(('note:JSONï¼šã¾ã¨ã‚'))

  * Support full text search against all texts in JSON\n
    (('note:JSONå†…ã®å…¨ãƒ†ã‚­ã‚¹ãƒˆå¯¾è±¡ã®å…¨æ–‡æ¤œç´¢ã‚’ã‚µãƒãƒ¼ãƒˆ'))

= Replication\n(('note:ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³'))

  * Support with PostgreSQL 9.6!\n
    (('note:PostgreSQL 9.6ã§ä½¿ã†å ´åˆã¯ã‚µãƒãƒ¼ãƒˆï¼'))
  * PostgreSQL 9.6 ships "generic WAL"\n
    (('note:PostgreSQL 9.6ã§ã€Œgeneric WALã€æ©Ÿèƒ½ãŒè¿½åŠ '))
    * Third party index can support WAL generation\n
      (('note:ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚‚WALã‚’ç”Ÿæˆã§ãã‚‹'))

= Implementation\n(('note:å®Ÿè£…'))

  (1) Master: Encode action logs as MessagePack\n
      (('note:ãƒã‚¹ã‚¿ãƒ¼ï¼šã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ­ã‚°ã‚’MessagePackã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰'))
  (2) Master: Write the action logs to WAL\n
      (('note:ãƒã‚¹ã‚¿ãƒ¼ï¼šã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ­ã‚°ã‚’WALã«æ›¸ãè¾¼ã¿'))
  (3) Slaves: Read the action logs and apply them\n
      (('note:ã‚¹ãƒ¬ãƒ¼ãƒ–ï¼šã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ­ã‚°ã‚’èª­ã¿è¾¼ã‚“ã§é©ç”¨'))

= Overview\n(('note:æ¦‚è¦'))

  # image
  # src = images/replication-overview.svg
  # relative_width = 100

= Action log: "action"\n(('note:ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ­ã‚°ï¼šã€Œã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€'))

  {
    "_action": ACTION_ID
  }
  # ACTION_ID: 0: INSERT
  # ACTION_ID: 1: CREATE_TABLE
  # ACTION_ID: 2: CREATE_COLUMN
  # ACTION_ID: 3: SET_SOURCES

= Action log: INSERT\n(('note:ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ­ã‚°ï¼šINSERT'))

  {
    "_action": 0,
    "_table":  "TABLE_NAME",
    "ctid":    PACKED_CTID_VALUE,
    "column1": COLUMN1_VALUE,
    ...
  }

= Action log: Logs\n(('note:ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ­ã‚°ï¼šè¤‡æ•°ãƒ­ã‚°'))

  {"_action": ACTION_ID, ...}
  {"_action": ACTION_ID, ...}
  {"_action": ACTION_ID, ...}
  ...

= Write action logs\n(('note:ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ­ã‚°ã®æ›¸ãè¾¼ã¿'))

  # image
  # src = images/replication-write-action-logs.svg
  # relative_height = 100

= Apply action logs\n(('note:ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ­ã‚°ã®é©ç”¨'))

  # image
  # src = images/replication-apply-action-logs.svg
  # relative_height = 100

= Action log: Why msgpack?\n(('note:ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ­ã‚°ï¼šã©ã†ã—ã¦msgpackï¼Ÿ'))

  * Because MessagePack supports streaming unpack\n
    (('note:MessagePackã¯ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã§å±•é–‹ã§ãã‚‹ã‹ã‚‰'))
    * It's useful to stop applying action logs when WAL is applied partially on slaves\n
      (('note:ã‚¹ãƒ¬ãƒ¼ãƒ–ã§WALãŒé€”ä¸­ã¾ã§ã—ã‹æ›¸ãè¾¼ã¾ã‚Œã¦ã„ãªã„ã¨ãã«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ­ã‚°ã®é©ç”¨ã‚’ä¸­æ–­ã§ãã‚‹ã®ã§ä¾¿åˆ©'))

= Replication: Wrap up\n(('note:ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼šã¾ã¨ã‚'))

  * Support with PostgreSQL 9.6!\n
    (('note:PostgreSQL 9.6ã§ä½¿ã†å ´åˆã¯ã‚µãƒãƒ¼ãƒˆï¼'))
  * Concept: Action logs on WAL\n
    (('note:ã‚³ãƒ³ã‚»ãƒ—ãƒˆï¼šWALä¸Šã«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ­ã‚°ã‚’æ›¸ã'))
    * It'll be an useful pattern for out of PostgreSQL storage index\n
      (('note:PostgreSQLç®¡ç†å¤–ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ä½¿ã†ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã§ã¯ã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒä½¿ãˆã‚‹ã¯ãš'))

= Wrap up1\n(('note:ã¾ã¨ã‚1'))

  * PostgreSQL doesn't support FTS for all languages\n
    (('note:PostgreSQLã®å…¨æ–‡æ¤œç´¢ã¯ä¸€éƒ¨ã®è¨€èªã®ã¿å¯¾å¿œ'))
  * PGroonga supports FTS for all languages\n
    (('note:PGroongaã®å…¨æ–‡æ¤œç´¢ã¯å…¨è¨€èªå¯¾å¿œ'))

= Wrap up2\n(('note:ã¾ã¨ã‚2'))

  * PGroonga is fast stably\n
    (('note:PGroongaã¯å®‰å®šã—ã¦é€Ÿã„'))
  * PGroonga supports FTS for all texts in JSON\n
    (('note:PGroongaã¯JSONä¸­ã®å…¨ãƒ†ã‚­ã‚¹ãƒˆã«å¯¾ã™ã‚‹å…¨æ–‡æ¤œç´¢ã«å¯¾å¿œ'))

= Wrap up3\n(('note:ã¾ã¨ã‚3'))

  * PGroonga supports replication\n
    (('note:PGroongaã¯ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œ'))
    * PostgreSQL 9.6 is required\n
      (('note:ãŸã ã—PostgreSQL 9.6ãŒå¿…è¦'))

= Wrap up4\n(('note:ã¾ã¨ã‚4'))

(('tag:center'))
PGroonga makes PostgreSQL\n
fast full text search platform\n
for all languages!

(('tag:center'))
(('note:PGroongaã§PostgreSQLãŒ'))\n
(('note:å…¨è¨€èªå¯¾å¿œé«˜é€Ÿå…¨æ–‡æ¤œç´¢ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã«ãªã‚‹ï¼'))

= See also

((<"https://pgroonga.github.io/"|URL:https://pgroonga.github.io/>))

  * Tutorial: ((<"/tutorial/"|URL:https://pgroonga.github.io/tutorial/>))
  * Install: ((<"/install/"|URL:https://pgroonga.github.io/install/>))
  * Reference: ((<"/reference/"|URL:https://pgroonga.github.io/reference/>))
    * Includes replication doc and benchmark docs
  * Community: ((<"/community/"|URL:https://pgroonga.github.io/community/>))
